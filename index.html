<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title></title>
	<style type="text/css">
		img{
			width: 40px;
			height: 40px;
			border-radius: 20px;
		}
	</style>
	<script src="js/jquery-1.11.0.min.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript">
		$(function(){
			let page=1;
			let pagecount=1;
			let rescount=0;
			
			// 切换头像的脚本
			let facestr="";
				for(let i=1;i<11;i++){
					facestr+='<option value="'+i+'.png">'+i+".png"+'</option>';
				}
			$("#face").html(facestr).change(function(){
				let _this=$(this);
				$("#img1").attr("src","img/face/"+_this.val());
			})
			$.ajaxSetup({
				type:"post",
				dataType:"json"
			})
			$.ajax({//先去取回页数  有页数才能去取留言的数据
				url:"./admins/rescount.php",
				success:function(res){
					console.log(res)
					rescount=res.rescount;
					pagecount=Math.ceil(rescount/5);
				}
			})//计算出总页数
			
			// 留言封装   --->取回留言之后的一些操作
			function ly(res){
				if(res.status=="10001"){
					console.log(res);
					let str="";
					$.each(res.data,function(index,value){
						str+='<tr><td><img src="./img/face/'+value.face+'"><span>['+value.author+']</span>在&lt;'+value.addTime+'&gt;</td></tr>'+"<tr><td>说:"+value.content+"</td></tr>"+(value.reply!=null?'<tr><td>管理员回复到:'+value.reply+"</td></tr>":"")
					});
					$("h3+.table-hover").html(str);
				}else{
					str="<tr><td>"+data.msg+"</td></tr>"
					$("h3+.table-hover").html(str);
				}
			}
			// 留言封装
			
			$.ajax({//取留言
				url:"./admins/message.php",
				data:{page:page},
				cache:false,
				success:function(res){
					ly(res);
				}
				
			})//取留言
			
			// 上一页
			let flag=true;
			$("#page a:first").click(function(){
				if(page<=1){
					page=1;
					flag=false;
				}else{
					flag=true;
					page=page-1;
				}
				if(page>=1&&flag){
					$.ajax({
						url:"./admins/message.php",
						data:{page:page},
						cache:false,
						success:function(res){
							ly(res);
						}
					})
				}
			})//点击上一页的事件
			
			// 下一页
			let flag1=true;
			$("#page a:last").click(function(){
				if(page>=pagecount){
					page=pagecount;
					flag=false;
				}else{
					flag=true;
					page=page+1;
				}
				if(page<=pagecount&&flag1){
					$.ajax({
						url:"./admins/message.php",
						data:{page:page},
						cache:false,
						success:function(res){
							ly(res);
						}
					})
				}
			})//点击上一页的事件
			
			// 发布留言
			function  leaveMessage(){
				
			}
			
			
		})
	</script>
</head>
<body>
	<div id="mask"></div>
	<div id="message">
		<h2>发布留言:</h2>
	    昵称:<input type="text" id="author">
	      <select id="face">
	      </select>
	      <img id="img1" src="img/face/1.png" width="30" />
	    <br>
		内容<textarea id="leaveContent" cols="53" rows="5"></textarea>
		<input type="button" class="btn btn-default" id="leaveBtn" value="发布留言">
		<input type="button" class="btn btn-default" id="cannel" value="取消">
	</div>
	<a href="javascript:;" id="leaveMessageBtn">发表留言</a>
	<h3>青春色彩留言板</h3>
	<table class="table table-hover">
	 
	</table>
	<div id="page">
	   <a href="javascript:;" class="btn btn-info">上一页</a>
	   <a href="javascript:;" class="btn btn-info">下一页</a>
	</div>
	
	<a href="admins/login.html">管理员登录</a>
</body>
</html>